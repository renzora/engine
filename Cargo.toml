# cargo-features = ["codegen-backend"]

[package]
name = "bevy_imgui_editor"
version = "0.1.0"
edition = "2021"
default-run = "renzora_editor"

[features]
default = ["editor", "dynamic", "physics", "memory-profiling"]
editor = ["dep:bevy_egui", "dep:egui-phosphor", "dep:rfd", "dep:libloading", "dep:notify", "dep:editor_plugin_api", "dep:rhai", "dep:image", "dep:arboard", "dep:ureq", "dep:open"]
runtime = ["physics"]
physics = ["dep:avian3d"]
dynamic = ["bevy/dynamic_linking"]
memory-profiling = ["dep:memory-stats"]

[[bin]]
name = "renzora_editor"
path = "src/main.rs"
required-features = ["editor"]

[[bin]]
name = "renzora_runtime"
path = "src/runtime/main.rs"
required-features = ["runtime"]

[[bin]]
name = "renzora_updater"
path = "updater/src/main.rs"

[dependencies]
bevy = { version = "0.18", features = ["dynamic_linking", "jpeg"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
ron = "0.8"
toml = "0.8"
dirs = "5.0"
zstd = "0.13"
gltf = "1.4"
image = { version = "0.25", optional = true }
memory-stats = { version = "1.2", optional = true }
log = { version = "*", features = ["max_level_debug", "release_max_level_warn"] }

# Physics engine (Avian - ECS-native physics for Bevy)
avian3d = { version = "0.5", optional = true }

# Mesh outline rendering
bevy_mod_outline = { path = "crates/bevy_mod_outline", default-features = false, features = ["reflect"] }

# Editor-only dependencies
bevy_egui = { version = "0.39", optional = true }
egui-phosphor = { version = "0.11", features = ["regular", "fill"], optional = true }
rfd = { version = "0.15", optional = true }
rhai = { version = "1.21", features = ["sync"], optional = true }
arboard = { version = "3.4", optional = true }
ureq = { version = "2.9", features = ["json"], optional = true }
open = { version = "5.0", optional = true }

# Plugin system dependencies (editor-only)
libloading = { version = "0.8", optional = true }
notify = { version = "6.0", optional = true }
editor_plugin_api = { path = "crates/editor_plugin_api", features = ["bevy"], optional = true }

[target.'cfg(windows)'.dependencies]
windows-sys = { version = "0.59", features = ["Win32_UI_WindowsAndMessaging", "Win32_Foundation", "Win32_System_Threading"] }
winit = "0.30"

[workspace]
members = ["crates/editor_plugin_api", "crates/bevy_mod_outline"]

# Bevy recommended optimizations
# https://bevy.org/learn/quick-start/getting-started/setup/

# [unstable]
# codegen-backend = true

[profile.dev]
opt-level = 1
# Note: Cranelift is incompatible with Bevy's dynamic linking on Windows nightly
# codegen-backend = "cranelift"

[profile.dev.package."*"]
opt-level = 3
# codegen-backend = "llvm"

[profile.release]
lto = "thin"

[build-dependencies]
winres = "0.1"
